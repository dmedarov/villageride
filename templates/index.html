{% extends "layout.html" %}
{% block content %}

<section class="hero">
  <h1>–°–ø–æ–¥–µ–ª–µ–Ω–∏ –ø—Ä–µ–≤–æ–∑–∏ –∑–∞ –û—Å–æ–π—Ü–∞</h1>
  <p class="hero-subtitle">
    –õ–µ—Å–µ–Ω –∏ –±–µ–∑–æ–ø–∞—Å–µ–Ω –Ω–∞—á–∏–Ω —Ö–æ—Ä–∞—Ç–∞ –≤ —Å–µ–ª–æ—Ç–æ –¥–∞ —Å—Ç–∏–≥–∞—Ç –¥–æ —Ä–∞–±–æ—Ç–∞, —É—á–∏–ª–∏—â–µ –∏ –ª–µ–∫–∞—Ä.
  </p>
</section>

<section class="grid-two">
  <!-- –õ—è–≤–∞ –∫–æ–ª–æ–Ω–∞: –ü—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–µ–≤–æ–∑ -->
  <div class="card">
    <header class="card-header">
      <h2>–ü—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–µ–≤–æ–∑</h2>
      <p class="card-subtitle">
        –ê–∫–æ –ø—ä—Ç—É–≤–∞—à —Å –∫–æ–ª–∞ ‚Äì –ø—Ä–µ–¥–ª–æ–∂–∏ —Å–≤–æ–±–æ–¥–Ω–∏—Ç–µ –º–µ—Å—Ç–∞ –Ω–∞ —Å—ä—Å–µ–¥–∏.
      </p>
    </header>

    <form method="post" action="{{ url_for('offer_ride') }}" class="form">
      <div class="form-group">
        <label for="offer-driver">–ò–º–µ –Ω–∞ —à–æ—Ñ—å–æ—Ä–∞</label>
        <input
          id="offer-driver"
          name="driver"
          type="text"
          required
          placeholder="–Ω–∞–ø—Ä. –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
        />
      </div>

      <div class="form-group">
        <label for="offer-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
        <input
          id="offer-phone"
          name="phone"
          type="tel"
          required
          placeholder="–Ω–∞–ø—Ä. 0888 123 456"
        />
      </div>

      <div class="form-group">
        <label for="offer-from">–û—Ç</label>
        <input
          id="offer-from"
          name="from_location"
          type="text"
          required
          placeholder="–Ω–∞–ø—Ä. –û—Å–æ–π—Ü–∞"
        />
      </div>

      <div class="form-group">
        <label for="offer-to">–î–æ</label>
        <input
          id="offer-to"
          name="to_location"
          type="text"
          required
          placeholder="–Ω–∞–ø—Ä. –°–æ—Ñ–∏—è, –±–æ–ª–Ω–∏—Ü–∞, —É—á–∏–ª–∏—â–µ‚Ä¶"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="offer-date">–î–∞—Ç–∞</label>
          <input id="offer-date" name="date" type="date" required />
        </div>
        <div class="form-group">
          <label for="offer-time">–ß–∞—Å</label>
          <input id="offer-time" name="time" type="time" required />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="offer-seats">–°–≤–æ–±–æ–¥–Ω–∏ –º–µ—Å—Ç–∞</label>
          <input
            id="offer-seats"
            name="seats"
            type="number"
            min="1"
            max="8"
            value="3"
            required
          />
        </div>
        <div class="form-group">
          <label for="offer-type">–¢–∏–ø –ø—Ä–µ–≤–æ–∑</label>
          <select id="offer-type" name="ride_type" required>
            <option value="work">–ó–∞ —Ä–∞–±–æ—Ç–∞</option>
            <option value="school">–ó–∞ —É—á–∏–ª–∏—â–µ</option>
            <option value="healthcare">–ó–∞ –∑–¥—Ä–∞–≤–µ</option>
            <option value="other">–î—Ä—É–≥</option>
          </select>
        </div>
      </div>

      <!-- –°–∫—Ä–∏—Ç–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –∑–∞ –∫–∞—Ä—Ç–∞ -->
      <input type="hidden" name="offer_from_lat" />
      <input type="hidden" name="offer_from_lng" />
      <input type="hidden" name="offer_to_lat" />
      <input type="hidden" name="offer_to_lng" />

      <button type="submit" class="btn-primary w-full">
        üöó –ü—É–±–ª–∏–∫—É–≤–∞–π –ø—Ä–µ–≤–æ–∑
      </button>

      <p class="form-hint">
        –°—ä–≤–µ—Ç: –º–æ–∂–µ—à –¥–∞ —Ü—ä–∫–Ω–µ—à –Ω–∞ –∫–∞—Ä—Ç–∞—Ç–∞ –¥–æ–ª—É, –∑–∞ –¥–∞ –ø–æ–ø—ä–ª–Ω–∏—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
        ‚Äû–û—Ç‚Äú –∏ ‚Äû–î–æ‚Äú –ø–æ —Ä–µ–∞–ª–Ω–æ –º—è—Å—Ç–æ.
      </p>
    </form>
  </div>

  <!-- –î—è—Å–Ω–∞ –∫–æ–ª–æ–Ω–∞: —Ç–∞–±–æ–≤–µ ‚Äû–ù–∞–ª–∏—á–Ω–∏ –ø—Ä–µ–≤–æ–∑–∏‚Äú / ‚Äû–¢—ä—Ä—Å—è –ø—Ä–µ–≤–æ–∑‚Äú -->
  <div class="card">
    <header class="card-header card-header-tabs">
      <div class="tabs">
        <button
          class="tab-link tab-active"
          data-tab-target="#rides-tab"
          type="button"
        >
          –ù–∞–ª–∏—á–Ω–∏ –ø—Ä–µ–≤–æ–∑–∏
        </button>
        <button
          class="tab-link"
          data-tab-target="#requests-tab"
          type="button"
        >
          –¢—ä—Ä—Å—è –ø—Ä–µ–≤–æ–∑
        </button>
      </div>
    </header>

    <div class="tab-panels">
      <!-- Tab: –Ω–∞–ª–∏—á–Ω–∏ –ø—Ä–µ–≤–æ–∑–∏ (—à–æ—Ñ—å–æ—Ä–∏) -->
      <section id="rides-tab" class="tab-panel tab-panel-active">
        {% if rides %}
        <ul class="ride-list">
          {% for r in rides %}
          <li class="ride-item">
            <div class="ride-main">
              <div class="ride-title">
                <strong>{{ r.driver }}</strong>
                <span class="ride-type-badge">
                  {{ r.ride_type_label }}
                </span>
              </div>
              <div class="ride-route">
                {{ r.from_location }} ‚Üí {{ r.to_location }}
              </div>
              <div class="ride-meta">
                <span>{{ r.date }} ‚Ä¢ {{ r.time }}</span>
                <span>{{ r.seats }} —Å–≤–æ–±–æ–¥–Ω–∏ –º–µ—Å—Ç–∞</span>
              </div>
            </div>
            <div class="ride-actions">
              {% if r.phone %}
              <a class="btn-outline" href="tel:{{ r.phone }}">üìû –û–±–∞–¥–∏ —Å–µ</a>
              {% endif %}
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="empty">
          –í—Å–µ –æ—â–µ –Ω—è–º–∞ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏ –ø—Ä–µ–≤–æ–∑–∏. –°—Ç–∞–Ω–∏ –ø—ä—Ä–≤–∏—è—Ç, –∫–æ–π—Ç–æ —â–µ –ø—Ä–µ–¥–ª–æ–∂–∏.
        </p>
        {% endif %}
      </section>

      <!-- Tab: –¢—ä—Ä—Å—è –ø—Ä–µ–≤–æ–∑ (–ø—ä—Ç–Ω–∏—Ü–∏) -->
      <section id="requests-tab" class="tab-panel">
        <form method="post" action="{{ url_for('request_ride') }}" class="form">
          <div class="form-group">
            <label for="request-passenger">–ò–º–µ</label>
            <input
              id="request-passenger"
              name="passenger"
              type="text"
              required
              placeholder="–Ω–∞–ø—Ä. –ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞"
            />
          </div>

          <div class="form-group">
            <label for="request-phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input
              id="request-phone"
              name="phone"
              type="tel"
              required
              placeholder="–Ω–∞–ø—Ä. 0888 456 789"
            />
          </div>

          <div class="form-group">
            <label for="request-from">–û—Ç</label>
            <input
              id="request-from"
              name="from_location"
              type="text"
              required
              placeholder="–Ω–∞–ø—Ä. –û—Å–æ–π—Ü–∞"
            />
          </div>

          <div class="form-group">
            <label for="request-to">–î–æ</label>
            <input
              id="request-to"
              name="to_location"
              type="text"
              required
              placeholder="–Ω–∞–ø—Ä. –°–æ—Ñ–∏—è, –±–æ–ª–Ω–∏—Ü–∞, —É—á–∏–ª–∏—â–µ‚Ä¶"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="request-date">–î–∞—Ç–∞</label>
              <input id="request-date" name="date" type="date" required />
            </div>
            <div class="form-group">
              <label for="request-time">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω —á–∞—Å</label>
              <input id="request-time" name="time" type="time" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="request-time-flex">–ì—ä–≤–∫–∞–≤–æ—Å—Ç</label>
              <select id="request-time-flex" name="time_flex" required>
                <option value="flex_30m">¬± 30 –º–∏–Ω</option>
                <option value="flex_1h">¬± 1 —á–∞—Å</option>
                <option value="morning">–ü–æ-—Å–∫–æ—Ä–æ —Å—É—Ç—Ä–∏–Ω</option>
                <option value="afternoon">–ü–æ-—Å–∫–æ—Ä–æ —Å–ª–µ–¥–æ–±–µ–¥</option>
              </select>
            </div>
            <div class="form-group">
              <label for="request-people-count">–ë—Ä–æ–π —Ö–æ—Ä–∞</label>
              <input
                id="request-people-count"
                name="people_count"
                type="number"
                min="1"
                max="4"
                value="1"
                required
              />
            </div>
          </div>

          <div class="form-group">
            <label for="request-note">–ë–µ–ª–µ–∂–∫–∞ (–ø–æ –∏–∑–±–æ—Ä)</label>
            <textarea
              id="request-note"
              name="note"
              rows="2"
              placeholder="–Ω–∞–ø—Ä. —Å –¥–µ—Ç–µ, —Å –∫—É—Ñ–∞—Ä, —Å –∫–æ–ª–∏—á–∫–∞‚Ä¶"
            ></textarea>
          </div>

          <!-- Hidden coords –∑–∞ –∑–∞—è–≤–∫–∞—Ç–∞ -->
          <input type="hidden" name="request_from_lat" />
          <input type="hidden" name="request_from_lng" />
          <input type="hidden" name="request_to_lat" />
          <input type="hidden" name="request_to_lng" />

          <button type="submit" class="btn-primary w-full">
            üôã‚Äç‚ôÄÔ∏è –ü—É–±–ª–∏–∫—É–≤–∞–π –∑–∞—è–≤–∫–∞ ‚Äû–¢—ä—Ä—Å—è –ø—Ä–µ–≤–æ–∑‚Äú
          </button>
        </form>

        <h3 class="section-title mt-4">–ê–∫—Ç–∏–≤–Ω–∏ –∑–∞—è–≤–∫–∏</h3>
        {% if requests %}
        <ul class="ride-list">
          {% for req in requests %}
          <li class="ride-item">
            <div class="ride-main">
              <div class="ride-title">
                <strong>{{ req.passenger }}</strong>
                <span class="ride-type-badge badge-request">
                  –¢—ä—Ä—Å–µ–Ω –ø—Ä–µ–≤–æ–∑
                </span>
              </div>
              <div class="ride-route">
                {{ req.from_location }} ‚Üí {{ req.to_location }}
              </div>
              <div class="ride-meta">
                <span>
                  {{ req.date }} ‚Ä¢ {{ req.time }}
                  {% if req.time_flex_label %}
                    ({{ req.time_flex_label }})
                  {% endif %}
                </span>
                <span>{{ req.people_count }} —á–æ–≤–µ–∫/–∞</span>
              </div>
              {% if req.note %}
              <div class="ride-note">
                <em>{{ req.note }}</em>
              </div>
              {% endif %}
            </div>
            <div class="ride-actions">
              {% if req.phone %}
              <a class="btn-outline" href="tel:{{ req.phone }}">üìû –û–±–∞–¥–∏ —Å–µ</a>
              {% endif %}
            </div>
          </li>
          {% endfor %}
        </ul>
        {% else %}
        <p class="empty">
          –í—Å–µ –æ—â–µ –Ω—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –∑–∞—è–≤–∫–∏. –î–æ–±–∞–≤–∏ —Å–≤–æ—è—Ç–∞, –∞–∫–æ —Ç—ä—Ä—Å–∏—à –ø—Ä–µ–≤–æ–∑.
        </p>
        {% endif %}
      </section>
    </div>
  </div>
</section>

<!-- –ö–∞—Ä—Ç–∞ -->
<section class="card map-card">
  <header class="card-header">
    <h2>–ö–∞—Ä—Ç–∞ –Ω–∞ –ø—Ä–µ–≤–æ–∑–∏—Ç–µ</h2>
    <div class="map-modes">
      <button
        type="button"
        class="pill-button"
        data-map-mode="from"
      >
        –ú–∞—Ä–∫–∏—Ä–∞–π ‚Äû–û—Ç‚Äú
      </button>
      <button
        type="button"
        class="pill-button"
        data-map-mode="to"
      >
        –ú–∞—Ä–∫–∏—Ä–∞–π ‚Äû–î–æ‚Äú
      </button>
    </div>
  </header>

  <div id="map"></div>

  <div class="map-legend">
    <span class="legend-item legend-work">–ü—Ä–µ–≤–æ–∑ –∑–∞ —Ä–∞–±–æ—Ç–∞</span>
    <span class="legend-item legend-school">–ü—Ä–µ–≤–æ–∑ –∑–∞ —É—á–∏–ª–∏—â–µ</span>
    <span class="legend-item legend-healthcare">–ü—Ä–µ–≤–æ–∑ –∑–∞ –∑–¥—Ä–∞–≤–µ</span>
    <span class="legend-item legend-other">–î—Ä—É–≥ –ø—Ä–µ–≤–æ–∑</span>
    <span class="legend-item legend-request">–¢—ä—Ä—Å–µ–Ω –ø—Ä–µ–≤–æ–∑</span>
  </div>
</section>

<script>
  window.ridesData = {{ rides_for_map|tojson|safe }};
  window.requestsData = {{ requests_for_map|tojson|safe }};
</script>

{% endblock %}
